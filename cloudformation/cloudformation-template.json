{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe": {
                "size": {
                    "width": 840,
                    "height": 330
                },
                "position": {
                    "x": 180,
                    "y": 90
                },
                "z": 1,
                "embeds": [
                    "a5d1af43-5c4a-4ea4-8912-3bdbad04af32",
                    "8d01642d-0468-4ffa-bf85-cbd91d0f6f36",
                    "fb700b4a-72f7-44ba-adba-22226bc59236",
                    "05f4fc0a-4dd7-4ff2-bada-e4144ccd9155",
                    "71f41640-f38d-44a7-a891-681d2b654ddb",
                    "d1a23951-0d8f-44e1-ab10-33fbeccb9068",
                    "d77c258c-6bb2-49b2-9fdd-5f6ba7400934"
                ]
            },
            "05f4fc0a-4dd7-4ff2-bada-e4144ccd9155": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 170
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": [],
                "dependson": [
                    "fb700b4a-72f7-44ba-adba-22226bc59236"
                ]
            },
            "fb700b4a-72f7-44ba-adba-22226bc59236": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 300
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": []
            },
            "71f41640-f38d-44a7-a891-681d2b654ddb": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 460,
                    "y": 170
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": [],
                "dependson": [
                    "05f4fc0a-4dd7-4ff2-bada-e4144ccd9155"
                ]
            },
            "d1a23951-0d8f-44e1-ab10-33fbeccb9068": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 710,
                    "y": 170
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": [],
                "dependson": [
                    "8d01642d-0468-4ffa-bf85-cbd91d0f6f36",
                    "71f41640-f38d-44a7-a891-681d2b654ddb",
                    "a5d1af43-5c4a-4ea4-8912-3bdbad04af32"
                ]
            },
            "8d01642d-0468-4ffa-bf85-cbd91d0f6f36": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 710,
                    "y": 310
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": []
            },
            "d77c258c-6bb2-49b2-9fdd-5f6ba7400934": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 570,
                    "y": 110
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": []
            },
            "a5d1af43-5c4a-4ea4-8912-3bdbad04af32": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 880,
                    "y": 310
                },
                "z": 2,
                "parent": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe",
                "embeds": []
            },
            "7cb52876-4707-4b47-866b-b826f9d7f372": {
                "source": {
                    "id": "d1a23951-0d8f-44e1-ab10-33fbeccb9068"
                },
                "target": {
                    "id": "a5d1af43-5c4a-4ea4-8912-3bdbad04af32"
                },
                "z": 3
            }
        }
    },
    "Resources": {
        "EC2WebApp": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "InstanceType": "t2.micro",
                "ImageId": "ami-0629230e074c580f2",
                "SecurityGroupIds": [
                    "sg-003a584ce7c13e0f0"
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "EC2WebApp"
                    }
                ],
                "KeyName": "aws-ec2-ssh-key"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "05f4fc0a-4dd7-4ff2-bada-e4144ccd9155"
                }
            },
            "DependsOn": [
                "DynamoTableBooks"
            ]
        },
        "DynamoTableBooks": {
            "Type": "AWS::DynamoDB::Table",
            "Properties": {
                "KeySchema": [
                    {
                        "AttributeName": "ISBN",
                        "KeyType": "HASH"
                    }
                ],
                "AttributeDefinitions": [
                    {
                        "AttributeName": "ISBN",
                        "AttributeType": "S"
                    }
                ],
                "ProvisionedThroughput": {
                    "ReadCapacityUnits": 5,
                    "WriteCapacityUnits": 5
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "DynamoTableBooks"
                    }
                ],
                "TableName": "stack-books"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fb700b4a-72f7-44ba-adba-22226bc59236"
                }
            }
        },
        "SQSLogger": {
            "Type": "AWS::SQS::Queue",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SQSLogger"
                    }
                ],
                "QueueName": "stack-sqsloggerqueue"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "71f41640-f38d-44a7-a891-681d2b654ddb"
                }
            },
            "DependsOn": [
                "EC2WebApp"
            ]
        },
        "LambdaLogProcessor": {
            "Type": "AWS::Lambda::Function",
            "Properties": {
                "Handler": "AWSLoggerLambda::AWSLoggerLambda.Function::FunctionHandler",
                "Runtime": "dotnetcore3.1",
                "Code": {
                    "S3Bucket": "loggerstorage",
                    "S3Key": "aws-task-lambda.zip"
                },
                "Description": "",
                "MemorySize": 256,
                "Timeout": 15,
                "Role": "arn:aws:iam::375297447026:role/service-role/LogProcessorLambda-role-cw3e6ay0",
                "VpcConfig": {
                    "SecurityGroupIds": [
                        "sg-003a584ce7c13e0f0"
                    ],
                    "SubnetIds": [
                        "subnet-05e6ae0144771ea74",
                        "subnet-0147807a062333027",
                        "subnet-0c0ef4fd49f6d3a4b"
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "LambdaLogProcessor"
                    }
                ],
                "FunctionName": "stack-logprocessorlambda",
                "PackageType": "Zip"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d1a23951-0d8f-44e1-ab10-33fbeccb9068"
                }
            },
            "DependsOn": [
                "S3LogStorage",
                "SQSLogger",
                "S3SrcStorage"
            ]
        },
        "S3LogStorage": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "S3LogStorage"
                    }
                ],
                "BucketName": "stack-logstorage"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8d01642d-0468-4ffa-bf85-cbd91d0f6f36"
                }
            }
        },
        "VPCWebApp": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": "172.31.0.0/16",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "VPCWebApp"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1de82e55-31bc-48ef-aa91-bdd9a5dcecbe"
                }
            }
        },
        "LambdaSqsTrigger": {
            "Type": "AWS::Lambda::EventSourceMapping",
            "Properties": {
                "Enabled": true,
                "EventSourceArn": {
                    "Fn::GetAtt": [
                        "SQSLogger",
                        "Arn"
                    ]
                },
                "FunctionName": {
                    "Ref": "LambdaLogProcessor"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d77c258c-6bb2-49b2-9fdd-5f6ba7400934"
                }
            }
        },
        "S3SrcStorage": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "S3SrcStorage"
                    }
                ],
                "BucketName": "stack-srcstorage"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a5d1af43-5c4a-4ea4-8912-3bdbad04af32"
                }
            }
        }
    }
}